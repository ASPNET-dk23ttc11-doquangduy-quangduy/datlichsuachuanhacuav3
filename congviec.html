<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>D·ªØ li·ªáu c√¥ng vi·ªác</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- FONT AWESOME ICONS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
      integrity="sha512-..."
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- PH·∫¶N HEADER -->
    <header
      style="
        background-color: #90cf88;
        color: white;
        text-align: center;
        padding: 20px 10px;
      "
    >
      <h2 style="margin: 0; font-weight: 800">
        DANH S√ÅCH C√ÅC C√îNG VI·ªÜC THEO L·ªäCH KH√ÅCH H√ÄNG ƒê·∫∂T
      </h2>
      <button
        onclick="window.location.href='index.html'"
        style="
          margin-top: 10px;
          background: #e09304;
          color: white;
          border: none;
          padding: 10px 20px;
          border-radius: 6px;
          cursor: pointer;
          font-weight: bold;
          transition: 0.3s;
        "
      >
        T·∫≠n t√¢m - An to√†n - Chu ƒë√°o - Hi·ªáu Qu·∫£
      </button>
    </header>
    <!-- MENU ƒêI·ªÄU H∆Ø·ªöNG -->
    <nav style="background-color: #003e7e; padding: 10px 0">
      <ul
        style="
          display: flex;
          justify-content: center;
          list-style: none;
          margin: 0;
          padding: 0;
          gap: 30px;
        "
      >
        <li>
          <a
            href="index.html"
            style="color: white; text-decoration: none; font-weight: bold"
            ><i class="fas fa-home"></i> Trang ch·ªß</a
          >
        </li>
        <li>
          <a
            href="datlich.html"
            style="color: white; text-decoration: none; font-weight: bold"
            ><i class="fas fa-calendar-alt"></i> ƒê·∫∑t l·ªãch</a
          >
        </li>
        <li>
          <a
            href="khachhang.html"
            style="color: white; text-decoration: none; font-weight: bold"
            ><i class="fas fa-users"></i> Kh√°ch h√†ng</a
          >
        </li>
        <li>
          <a
            href="admin.html"
            style="color: white; text-decoration: none; font-weight: bold"
            ><i class="fas fa-tools"></i> Qu·∫£n tr·ªã</a
          >
        </li>
        <li>
          <a
            href="lienhe.html"
            style="color: white; text-decoration: none; font-weight: bold"
            ><i class="fas fa-phone"></i> Li√™n h·ªá</a
          >
        </li>
      </ul>
    </nav>
    <!-- Bootstrap & DataTables -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css"
    />

    <style>
      body {
        background-color: #f4f6f9;
        font-family: "Segoe UI", sans-serif;
        padding: 30px;
      }
      h2 {
        text-align: center;
        margin-bottom: 20px;
        color: #343a40;
      }
      .custom-btn {
        margin: 10px 5px;
      }
      table.dataTable thead {
        background-color: #6f42c1;
        color: white;
      }
      select.form-select {
        min-width: 140px;
      }
    </style>
  </head>
  <body>
    <h2>D·ªØ li·ªáu c√¥ng vi·ªác</h2>

    <div class="d-flex justify-content-end mb-3">
      <a
        href="https://docs.google.com/spreadsheets/d/1v81SEPJpK9PH47njZImBiR0aznSgiCK85quCh4FWHm8/edit?usp=sharing"
        target="_blank"
        class="btn btn-outline-primary custom-btn"
        >üìÑ M·ªü file g·ªëc</a
      >
      <button id="saveStatusBtn" class="btn btn-success custom-btn">
        üíæ C·∫≠p nh·∫≠t tr·∫°ng th√°i
      </button>
    </div>

    <div class="table-responsive">
      <table
        id="dataTable"
        class="display table table-striped table-bordered"
        style="width: 100%"
      >
        <thead>
          <tr>
            <th>Th·ªùi gian</th>
            <th>H·ªç v√† t√™n</th>
            <th>SƒêT</th>
            <th>D·ªãch v·ª•</th>
            <th>Ng√†y</th>
            <th>Gi·ªù</th>
            <th>Y√™u c·∫ßu</th>
            <th>ƒê·ªãa ch·ªâ</th>
            <th>Tr·∫°ng th√°i</th>
            <th>Ch·ª©c nƒÉng</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
    <script>
      const SHEET_API_URL =
        "https://script.google.com/macros/s/AKfycbzzGKybdxHzZ2Ue2-5j9AAQhVa85evB5L1evQJf5z0deUHdxHBU5QCjBVbhG9lJCzkS/exec";
      let table;

      fetch(SHEET_API_URL)
        .then((res) => res.json())
        .then((data) => {
          const tbody = document.querySelector("#dataTable tbody");
          data.forEach((row) => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
            <td>${row.timestamp || ""}</td>
            <td>${row.name || ""}</td>
            <td>${row.phone || ""}</td>
            <td>${row.service || ""}</td>
            <td>${row.date || ""}</td>
            <td>${row.time || ""}</td>
            <td>${row.request || ""}</td>
            <td>${row.address || ""}</td>
            <td>${row.status || ""}</td>
            <td>
              <select class="form-select" data-row-index="${row.rowIndex}">
                <option value="Ch∆∞a x·ª≠ l√Ω" ${
                  row.status === "Ch∆∞a x·ª≠ l√Ω" ? "selected" : ""
                }>Ch∆∞a x·ª≠ l√Ω</option>
                <option value="ƒê√£ x·ª≠ l√Ω" ${
                  row.status === "ƒê√£ x·ª≠ l√Ω" ? "selected" : ""
                }>‚úîÔ∏è ƒê√£ x·ª≠ l√Ω</option>
                <option value="ƒêang x·ª≠ l√Ω" ${
                  row.status === "ƒêang x·ª≠ l√Ω" ? "selected" : ""
                }>‚è≥ ƒêang x·ª≠ l√Ω</option>
                <option value="H·ªßy" ${
                  row.status === "H·ªßy" ? "selected" : ""
                }>‚ùå H·ªßy</option>
              </select>
            </td>
          `;
            tbody.appendChild(tr);
          });

          table = $("#dataTable").DataTable();
        });

      document.getElementById("saveStatusBtn").addEventListener("click", () => {
        const updates = [];
        document.querySelectorAll("select.form-select").forEach((select) => {
          updates.push({
            rowIndex: parseInt(select.dataset.rowIndex),
            status: select.value,
          });
        });

        fetch(SHEET_API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ updates: updates }),
        })
          .then((response) => response.text())
          .then((msg) => {
            alert("‚úÖ " + msg);
          })
          .catch((error) => {
            alert("‚ùå L·ªói khi l∆∞u tr·∫°ng th√°i: " + error.message);
          });
      });
    </script>
  </body>
</html>
